---
title: "Drug Code"
---

## Overall description

The drug data was collected by The National Survey on Drug Use and Health (NSDUH), an annual survey conducted in all 50 states and the District of Columbia. There were approximately 70,000 participants and questions on tobacco, alcohol, and drug use, mental health and other health-related issues were asked. Our study focued on substance abuse (alcohol, marijuana, cocaine, and illicit drugs).



```{r setup, include=FALSE}
library(tidyverse)
library(readxl)
library(PerformanceAnalytics)
library(rvest)
library(httr)
library(gridExtra)
library(flexdashboard)
library(viridis)
library(plotly)
library(gsheet)
```


```{r read_data, echo=FALSE, message=FALSE}
drug_raw =
  read_csv("https://think.cs.vt.edu/corgis/csv/drugs/drugs.csv?forcedownload=1/drugs.csv") %>%
  janitor::clean_names()
```


```{r clean_data,echo=FALSE,warning=FALSE,message=FALSE}
drug_data = 
  drug_raw %>%
  select(year, state,
         rates_alcohol_abuse_past_year_12_17:rates_alcohol_dependence_past_year_26,
         rates_alcohol_need_treatment_past_year_12_17:rates_illicit_drugs_abuse_past_month_26, 
         rates_illicit_drugs_cocaine_used_past_year_12_17:rates_illicit_drugs_need_treatment_past_year_26,
         rates_marijuana_new_users_12_17:rates_marijuana_used_past_year_26) %>%
  gather(key, value, -state, -year) %>% 
  mutate(key = str_replace_all(key, c("year_" = "year:", "month_" = "month:", "risk_" = "risk:", "users_" = "users:"))) %>%
  separate(key, into = c("rate", "age"), sep = ":", extra = "merge") %>%
  mutate(rate = str_replace(rate, "^rates_", "")) %>% 
  spread(rate, value)

population_data = 
  drug_raw %>% 
  select(x12_17, x18_25:x26, year, state) %>% 
  gather(key = "age", value = "popul_in_thousands", -state, -year) %>% 
  mutate(age = str_replace(age, "x", ""))

drug_clean = left_join(drug_data, population_data)
```

## Trend of different drug uses by age groups


```{r, echo = FALSE, warning = FALSE}
drug_raw %>%
  select(year, state,
         rates_alcohol_abuse_past_year_12_17:rates_alcohol_dependence_past_year_26,
         rates_alcohol_need_treatment_past_year_12_17:rates_illicit_drugs_abuse_past_month_26, 
         rates_illicit_drugs_cocaine_used_past_year_12_17:rates_illicit_drugs_need_treatment_past_year_26,
         rates_marijuana_new_users_12_17:rates_marijuana_used_past_year_26) %>%
  gather(key, value, -state, -year) %>% 
  mutate(key = str_replace_all(key, c("year_" = "year:", "month_" = "month:", "risk_" = "risk:", "users_" = "users:"))) %>%
  separate(key, into = c("rate", "age"), sep = ":", extra = "merge") %>%
  mutate(rate = str_replace(rate, "^rates_", "")) %>% 
# Make a line plot 
    filter(!str_detect(rate, "perceptions"),
         !str_detect(rate, "past_month"),
         !str_detect(rate, "new_user")) %>%
  mutate(rate = str_replace(rate, "alcohol_", "alcohol:"),
         rate = str_replace(rate, "illicit_drugs_", "illicit_drugs:"),
         rate = str_replace(rate, "marijuana_", "marijuana:")) %>% 
  separate(rate, into = c("drug", "other"), by = ":") %>% 
  select(-other) %>%
  group_by(year, drug, age) %>% 
  summarize(rate = sum(value)) %>% 
  ggplot(aes(x = year, y = rate, 
             color = drug, 
             group = interaction(age, drug))) +
  geom_line() +
  geom_point(aes(shape = age)) +
  theme_bw() +
  labs(
    title = "Drug use in 2002-2014 by age group",
    x = "Year",
    y = "Rate of drug use (in thousands)",
    caption = "Data from the drug dataset"
  ) +
   theme(legend.position = "bottom") +
  scale_x_continuous(breaks = c(2002, 2004, 2006, 2008, 2010, 2012, 2014))
```

The highest rates of alcohol, illicit drugs, and marijuana were among people aged 18 to 25. There was a decreasing trend in alcohol abuse among people aged 12 to 25. The rates of both illicit drugs--cocaine and marijuana, in general, remained constant throughout years.

